<!DOCTYPE html>
<html>
<head>
    <title>Debug Google Apps Script Connection</title>
</head>
<body>
    <h1>Google Apps Script Debug</h1>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="testAddTransaction()">Test Add Transaction</button>
    <button onclick="testGetTransactions()">Test Get Transactions</button>
    <div id="output"></div>

    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzih_hnu752ZC1u3WdPZ5KLNJGhF1UdZzbZVUknSXUh0ALOyH8FW81ucfc2R9O2hco/exec';
        
        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }

        async function testConnection() {
            log('üîÑ Testing connection...');
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=test', {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/plain',
                    }
                });
                
                log('Response status: ' + response.status);
                log('Response headers: ' + JSON.stringify([...response.headers.entries()]));
                
                if (response.ok) {
                    const text = await response.text();
                    log('‚úÖ Success: ' + text);
                } else {
                    log('‚ùå Failed: ' + response.statusText);
                }
            } catch (error) {
                log('üí• Error: ' + error.message);
            }
        }

        async function testAddTransaction() {
            log('üîÑ Testing add transaction...');
            try {
                const testData = {
                    action: 'add',
                    data: {
                        id: 'test_' + Date.now(),
                        date: new Date().toISOString(),
                        type: 'credit',
                        paymentMethod: 'cash',
                        company: 'Test Company',
                        person: 'Test Person',
                        location: 'Test Location',
                        recordedBy: 'Test User',
                        amount: 1000,
                        notes: 'Test transaction',
                        breakdown: JSON.stringify({500: 2}),
                        timestamp: new Date().toISOString()
                    }
                };

                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });

                log('Add response status: ' + response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    log('‚úÖ Add success: ' + JSON.stringify(result));
                } else {
                    const errorText = await response.text();
                    log('‚ùå Add failed: ' + errorText);
                }
            } catch (error) {
                log('üí• Add error: ' + error.message);
            }
        }

        async function testGetTransactions() {
            log('üîÑ Testing get transactions...');
            try {
                const url = new URL(GOOGLE_APPS_SCRIPT_URL);
                url.searchParams.append('action', 'getAll');
                url.searchParams.append('recordedBy', 'Test User');

                const response = await fetch(url.toString(), {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                log('Get response status: ' + response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    log('‚úÖ Get success: ' + JSON.stringify(result));
                } else {
                    const errorText = await response.text();
                    log('‚ùå Get failed: ' + errorText);
                }
            } catch (error) {
                log('üí• Get error: ' + error.message);
            }
        }
    </script>
</body>
</html>